# NASA APOD Android App

Приложение для просмотра астрономических фотографий дня от NASA (Astronomy Picture of the Day).

## Возможности

- 📱 Современный UI на Jetpack Compose
- 🌌 Просмотр списка астрономических фотографий с пагинацией
- 🔍 Детальная информация о каждой фотографии
- ❤️ Добавление в избранное
- 🔄 Обновление данных с прогресс индикатором
- 📱 Адаптивный дизайн
- 🌐 Офлайн режим с кэшированием
- 🔧 Clean Architecture
- 🧪 Переключение между API и мок-данными
- 🎨 Переключатель темы (светлая/тёмная/системная)

## Технологии

- **Kotlin** - основной язык программирования
- **Jetpack Compose** - современный UI фреймворк
- **Clean Architecture** - архитектурный паттерн
- **Dagger Hilt** - dependency injection
- **Retrofit** - для сетевых запросов
- **Room** - локальная база данных
- **Paging 3** - пагинация данных
- **Coil** - для загрузки изображений
- **Navigation Compose** - для навигации
- **ViewModel** - для управления состоянием
- **Material 3** - дизайн система
- **Coroutines & Flow** - асинхронное программирование
- **BuildConfig** - переключение между API и мок-данными

## Архитектура

Проект построен по принципам Clean Architecture:

```
┌─────────────────────────────────────────────────────────────┐
│                    PRESENTATION LAYER                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐  │
│  │   ViewModels      │  │   UI Screens    │  │ Navigation  │  │
│  │   (@HiltViewModel)│  │   (Compose)    │  │   (Compose) │  │
│  └─────────────────┘  └─────────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      DOMAIN LAYER                          │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐  │
│  │   Use Cases     │  │   Apod Model   │  │ Repository  │  │
│  │   (@Inject)     │  │   (Domain)     │  │ Interface   │  │
│  └─────────────────┘  └─────────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              ▲
                              │
┌─────────────────────────────────────────────────────────────┐
│                      DATA LAYER                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐  │
│  │   API Service   │  │   Database      │  │ Repository  │  │
│  │   (Retrofit)    │  │   (Room)        │  │ Impl        │  │
│  │                 │  │                 │  │ (@Singleton)│  │
│  └─────────────────┘  └─────────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## Структура проекта

```
app/src/main/java/com/example/planets/
├── data/
│   ├── api/              # API сервисы (Retrofit)
│   ├── database/         # Room база данных
│   ├── mapper/           # Мапперы между слоями
│   ├── model/            # Модели данных (API)
│   ├── paging/           # PagingSource для пагинации
│   └── repository/       # Реализация репозитория
├── di/                   # Dagger Hilt модули
├── domain/
│   ├── error/           # Доменные ошибки
│   ├── model/           # Доменные модели
│   ├── repository/      # Интерфейс репозитория
│   └── usecase/         # Use Cases (интерфейсы + реализации)
├── navigation/          # Навигация (Compose)
├── presentation/
│   ├── components/      # Переиспользуемые компоненты
│   ├── screens/         # Экраны приложения
│   ├── theme/           # Тема приложения
│   └── viewmodel/       # ViewModels для каждого экрана (@HiltViewModel)
│       ├── ApodListViewModel.kt      # ViewModel для списка APOD
│       ├── ApodDetailViewModel.kt    # ViewModel для деталей APOD
│       ├── FavoritesViewModel.kt    # ViewModel для избранного
│       └── SettingsViewModel.kt     # ViewModel для настроек
├── utils/               # Утилиты (NetworkMonitor)
├── MainActivity.kt      # Главная активность (@AndroidEntryPoint)
└── PlanetsApplication.kt # Application класс (@HiltAndroidApp)
```

## API

Приложение использует NASA APOD API:
- **Базовый URL**: `https://api.nasa.gov/`
- **Endpoint**: `planetary/apod`
- **API Key**: `cVsJ9alkirbS7Jmj5bA3zFHdopkvdEqnKG45p34o`
- **Логирование**: Все HTTP запросы логируются в Logcat

## 🧪 Переключение между API и мок-данными

Приложение поддерживает переключение между реальным NASA API и тестовыми мок-данными для разработки и тестирования.

### 🔄 Как переключаться

#### Включить мок-данные (для тестирования):
1. Откройте файл `app/build.gradle.kts`
2. Найдите строку: `buildConfigField("boolean", "USE_MOCK_DATA", "false")`
3. Измените на: `buildConfigField("boolean", "USE_MOCK_DATA", "true")`
4. Синхронизируйте проект (Sync Now)
5. Пересоберите приложение

#### Вернуться к реальному API:
1. Откройте файл `app/build.gradle.kts`
2. Найдите строку: `buildConfigField("boolean", "USE_MOCK_DATA", "true")`
3. Измените на: `buildConfigField("boolean", "USE_MOCK_DATA", "false")`
4. Синхронизируйте проект (Sync Now)
5. Пересоберите приложение

### 📊 Преимущества мок-данных

- ✅ **Быстрая загрузка** - нет сетевых запросов
- ✅ **Офлайн работа** - не требует интернета
- ✅ **Стабильные данные** - всегда одинаковый результат
- ✅ **Легкая отладка** - предсказуемые данные
- ✅ **Демонстрации** - идеально для презентаций

### 🎯 Когда использовать мок-данные

- **Разработка UI** - тестирование интерфейса
- **Отладка** - когда API недоступен
- **Демонстрация** - показ приложения без интернета
- **Тестирование** - unit и UI тесты
- **Презентации** - стабильные данные

### ⚠️ Важно

- **По умолчанию** используется реальный API (`USE_MOCK_DATA = false`)
- **Не забывайте** переключаться обратно перед релизом
- **Все функции** работают в обоих режимах (избранное, кэш, настройки)

Подробное руководство: [MOCK_DATA_GUIDE.md](MOCK_DATA_GUIDE.md)
- **API Key**: `cVsJ9alkirbS7Jmj5bA3zFHdopkvdEqnKG45p34o` (для демонстрации)

## Установка и запуск

1. Клонируйте репозиторий
2. Откройте проект в Android Studio
3. Синхронизируйте Gradle
4. Запустите приложение на устройстве или эмуляторе

## Требования

- Android SDK 28+
- Kotlin 2.0.21+
- Android Studio Arctic Fox+

## Функциональность

### Главный экран
- Сетка из астрономических фотографий с пагинацией
- Кнопка обновления данных
- Прогресс индикатор при повторной попытке
- Обработка ошибок загрузки (сеть, HTTP)
- Офлайн режим с кэшированными данными

### Экран деталей
- Полноразмерное изображение
- Заголовок и дата
- Подробное описание
- Кнопка "Назад"

### Экран избранного
- Список сохраненных фотографий
- Управление избранным

### Экран настроек
- Очистка кэша
- Информация о приложении

## 🎯 Преимущества Clean Architecture

### ✅ Разделение ответственности
- **Каждый экран имеет свою ViewModel** - четкое разделение логики между экранами
- **Use Cases** - изолированная бизнес-логика
- **Repository Pattern** - абстракция над источниками данных

### ✅ Тестируемость
- **Интерфейсы Use Cases** - легко мокать для тестов
- **Dependency Injection** - простое внедрение зависимостей
- **Изолированные компоненты** - каждый можно тестировать отдельно

### ✅ Масштабируемость
- **Модульная структура** - легко добавлять новые функции
- **Слабая связанность** - изменения в одном слое не влияют на другие
- **Переиспользование** - Use Cases можно использовать в разных ViewModel

### ✅ Поддержка
- **Четкая структура** - легко найти нужный код
- **Документированные интерфейсы** - понятные контракты между слоями
- **Консистентность** - единый подход во всем проекте

## 🔄 Механизм уведомления об очистке кэша

### Проблема
После очистки кэша в настройках, данные не обновлялись сразу в других экранах, а только после переключения между вкладками.

### Решение
Реализован механизм уведомления об очистке кэша с использованием `SharedFlow`:

```kotlin
// 1. Use Case для уведомления
interface NotifyCacheClearedUseCase {
    fun getCacheClearedFlow(): Flow<Unit>
    suspend fun notifyCacheCleared()
}

// 2. Уведомление при очистке
class ClearCacheUseCaseImpl {
    override suspend operator fun invoke(): Result<Unit> {
        val result = repository.clearAllCache()
        if (result.isSuccess) {
            notifyCacheClearedUseCase.notifyCacheCleared() // ✅ Уведомляем
        }
        return result
    }
}

// 3. Слушаем уведомления в ViewModel
class ApodListViewModel {
    init {
        viewModelScope.launch {
            notifyCacheClearedUseCase.getCacheClearedFlow().collect {
                clearError()           // ✅ Сбрасываем ошибки
                _refreshTrigger.value++ // ✅ Обновляем данные
            }
        }
    }
}
```

### Преимущества
- ✅ **Мгновенное обновление** - данные обновляются сразу после очистки
- ✅ **Реактивность** - все экраны автоматически реагируют на изменения
- ✅ **Слабая связанность** - компоненты не знают друг о друге напрямую
- ✅ **Масштабируемость** - легко добавить новые слушатели

## Особенности реализации

- **Clean Architecture** - четкое разделение слоев
- **Dagger Hilt** - автоматическая инъекция зависимостей
- **Use Case Interfaces** - интерфейсы для всех бизнес-логики
- **Paging 3** - эффективная пагинация с кэшированием
- **Room** - локальное хранение данных
- **Retrofit** - сетевые запросы с логированием
- **Jetpack Compose** - современный декларативный UI
- **Material 3** - актуальная дизайн система
- **Coroutines & Flow** - реактивное программирование

## Логирование

Для отладки доступны следующие теги в Logcat:
- `OkHttp` - HTTP запросы и ответы
- `ApiClient` - инициализация API клиента
- `ApodPagingSource` - логи загрузки данных с API
- `MockApodPagingSource` - логи загрузки мок-данных
- `MockApodRepositoryImpl` - операции с мок-данными

## Лицензия

Этот проект создан для образовательных целей и использует публичный API NASA.
